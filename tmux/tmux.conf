# Shell
#
# Set shell to zsh
set-option -g default-shell /usr/local/bin/zsh
#
# And set default-command for every window
set -g default-command "reattach-to-user-namespace -l zsh"

# List of plugins
set -g @plugin 'tmux-plugins/tpm'

# Sensible defaults
set -g @plugin 'tmux-plugins/tmux-sensible'

# window pane controls
set -g @plugin 'tmux-plugins/tmux-pain-control'

# system copy mode
# TODO: figure out how this works
set -g @plugin 'tmux-plugins/tmux-plugins/tmux-yank'

# tmux neovim uniform navigation
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' { if -F '#{pane_at_left}' '' 'select-pane -L' }
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' { if -F '#{pane_at_bottom}' '' 'select-pane -D' }
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' { if -F '#{pane_at_top}' '' 'select-pane -U' }
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' { if -F '#{pane_at_right}' '' 'select-pane -R' }

bind-key -T copy-mode-vi 'C-h' if -F '#{pane_at_left}' '' 'select-pane -L'
bind-key -T copy-mode-vi 'C-j' if -F '#{pane_at_bottom}' '' 'select-pane -D'
bind-key -T copy-mode-vi 'C-k' if -F '#{pane_at_top}' '' 'select-pane -U'
bind-key -T copy-mode-vi 'C-l' if -F '#{pane_at_right}' '' 'select-pane -R'


# panes
set -g pane-active-border-style 'bg=colour0 fg=colour4'

# basic settings
set-window-option -g xterm-keys on # for vim
set-window-option -g mode-keys vi # vi key

# Set window notifications
setw -g monitor-activity on
set -g visual-activity off

# Color
#
# support italics also
set -g default-terminal "tmux-256color"
# tell Tmux that outside terminal supports true color
set -ga terminal-overrides ",xterm-256color*:Tc"
# undercurl support
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
# underscore colours - needs tmux-3.0
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# Status bar
#
#   Get rid of showing the current window index
set -g status-interval 1
set -g status-left ''
set-option -g status-bg colour13
set-option -g status-fg black


#   status right side
set-option -g status-right-length 90
set -g status-right '\
#[fg=colour250,bg=magenta,bold] #(~/.tmux/bin/wifi)\
#[fg=colour250,bg=lightmagenta,bold] %m/%d/%y \
#[fg=colour250,bg=darkmagenta,bold] %H:%M:%S '

# vi movement keys
set-option -g status-keys vi

# cleaning the screen
#
#  clear screen (r for refresh)
bind-key C-r send-keys 'C-l'
# bind-key b send-keys -R \; send-keys C-l
#  clear history and screen (f for flush)
bind-key C-f send-keys -R \; clear-history \; send-keys C-l

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
